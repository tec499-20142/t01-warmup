% LaTeX definitions for ipPROCESS documentation style
%
% Created by João Carlos Nunes Bittencourt, june 2011
% updated agust 2014
% 
% Dependencies

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{ipprocess}[2014/08/18]

%\usepackage[latin1]{inputenc} 
\usepackage[usenames,dvipsnames,svgnames,table]{xcolor}
\usepackage{color}
\usepackage{paralist}
\usepackage{graphicx}
\usepackage{url}
% \usepackage{array}
\usepackage{array}
\usepackage{ragged2e}
\usepackage{sectsty}
\usepackage{float}
\usepackage{placeins}
\usepackage{subcaption}
\usepackage{epstopdf}
%\usepackage[table]{xcolor}
\RequirePackage{fancyhdr} 
\usepackage{enumitem} % load this package for custom enumerate items

\fancyhf{}


\usepackage{endnotes}
\let\footnote=\endnote

\setlength{\headheight}{29pt}
\renewcommand{\headrulewidth}{0pt} % remove lines as well

% margem sup 3.5 cm: há 1,5 cm para header, + 2 cm para top
% margem inf 2.5 cm: há 1,5 cm para foot, + 1 cm para bottom
% margem esq/dir 3 cm
\RequirePackage[a4paper,top=3.5cm,left=3cm,right=3cm,bottom=3.5cm]{geometry}

\parindent 1.27cm
\parskip   6pt

\flushbottom
% set table internal padding
\renewcommand{\arraystretch}{1.5}

% captions
%\usepackage[font=sf, labelfont={sf,bf}, margin=1cm]{caption}
\RequirePackage[font={normalsize,bf}, labelfont={sf,bf,color=gray}, margin=1cm]{caption}
%\setlength{\captionmargin}{0.8cm}
%\renewcommand{\captionfont}{\color{gray}\bfseries}
%\renewcommand{\captionlabeldelim}{.}

% font
\usepackage{libertine}
%\usepackage[scaled]{helvet}
\renewcommand*\familydefault{\sfdefault} %% Only if the base font of the document is to be sans serif
\usepackage[T1]{fontenc}

\renewcommand{\normalsize}{\@setfontsize\normalsize\@xiipt\@xivpt}
\newcommand{\XIIIPT}{\@setfontsize\xiiipt{13}{17}}
\newcommand{\XVIPT}{\@setfontsize\xvipt{16}{20}}

% new commands
\renewcommand\tableofcontents{%
  \newpage
  \vspace*{1.5cm}
  \section*{\centering\MakeUppercase\contentsname}%
  \vspace*{2cm}
  \@starttoc{toc}%
}

% to avoid [...] in the bibliography
% \item[] instead of \item[\@biblabel{#1}\hfill]
\def\@lbibitem[#1]#2{\item[]\if@filesw
      {\let\protect\noexpand
       \immediate
       \write\@auxout{\string\bibcite{#2}{#1}}}\fi\ignorespaces}
\renewenvironment{thebibliography}[1]
     {\section{\refname
        \@mkboth{\MakeUppercase\refname}{\MakeUppercase\refname}}%
      \list{\@biblabel{\@arabic\c@enumiv}}%
           {\settowidth\labelwidth{\@biblabel{#1}}%
            \leftmargin\labelwidth
            \advance\leftmargin\labelsep
            %% changed!
               \itemindent -\leftmargin
               \itemsep 6pt
            %%%%%%%%%%%
            \@openbib@code
            \usecounter{enumiv}%
            \let\p@enumiv\@empty
            \renewcommand\theenumiv{\@arabic\c@enumiv}}%
      \sloppy
      \clubpenalty4000
      \@clubpenalty \clubpenalty
      \widowpenalty4000%
      \sfcode`\.\@m}
     {\def\@noitemerr
       {\@latex@warning{Empty `thebibliography' environment}}%
      \endlist}

% front cover
\pagestyle{fancy}

\providecommand{\ipPROCESSDocumentTitle}{}
\newcommand{\DocumentTitle}[1]{\renewcommand{\ipPROCESSDocumentTitle}{#1}}

\providecommand{\ipPROCESSProject}{}
\newcommand{\Project}[1]{\renewcommand{\ipPROCESSProject}{#1}}

\providecommand{\ipPROCESSOrganization}{}
\newcommand{\Organization}[1]{\renewcommand{\ipPROCESSOrganization}{#1}}

\providecommand{\ipPROCESSVersion}{}
\newcommand{\Version}[1]{\renewcommand{\ipPROCESSVersion}{#1}}

\newcommand{\capa}
{
  \begin{titlepage}
    \vspace*{9cm}
    \begin{figure}[h]
      \begin{flushright}
        \includegraphics[width=0.4\linewidth]{pictures/ipprocess.png}
      \end{flushright}
    \end{figure}
    \begin{flushright}
      \uppercase{\textbf{\ipPROCESSDocumentTitle}}\par
      \ipPROCESSProject \par
      \vspace*{3.5cm}
      \ipPROCESSOrganization \par
      \textbf{\ipPROCESSVersion} \par
    \end{flushright}
    \vspace*{4cm}
    \centering
  \end{titlepage}
}

% header and footer
\rhead{\includegraphics[width=0.7\linewidth]{pictures/header.png}}
\lfoot{\hrulefill \\ \small\ipPROCESSDocumentTitle}
\cfoot{\hrulefill \\ \small\centering\textbf{\ipPROCESSOrganization}}
\rfoot{\hrulefill \\ \small\thepage}


% itens
%\setlength\leftmargini   {1.27cm}
\setlength\leftmargin    {\leftmargini}
\setlength\leftmarginii  {\leftmargini}
\setlength\leftmarginiii {\leftmargini}
\setlength\leftmarginiv  {\leftmargini}
\setlength  \labelsep    {.5em}
\setlength  \labelwidth  {\leftmargini}
\addtolength\labelwidth  {-\labelsep}
\def\@listI{\leftmargin\leftmargini
            \parsep 0\p@ \@plus1\p@ \@minus\p@
            \topsep 0\p@ \@plus2\p@ \@minus4\p@
            \itemsep0\p@}
\let\@listi\@listI
\@listi
\def\@listii {\leftmargin\leftmarginii
              \labelwidth\leftmarginii
              \advance\labelwidth-\labelsep
              \topsep    0\p@ \@plus2\p@ \@minus\p@}
\def\@listiii{\leftmargin\leftmarginiii
              \labelwidth\leftmarginiii
              \advance\labelwidth-\labelsep
              \topsep    0\p@ \@plus\p@\@minus\p@
              \parsep    \z@
              \partopsep \p@ \@plus\z@ \@minus\p@}
% set new spacing
\newlength{\wideitemsep}
\setlength{\wideitemsep}{\itemsep}
\addtolength{\wideitemsep}{10pt}
\let\olditem\item
\renewcommand{\item}{\setlength{\itemsep}{\wideitemsep}\olditem}             

% sections
% set color for section numbering
\renewcommand\thesection{\color{gray}\arabic{section}}
\renewcommand\section{\@startsection{section}{1}{\z@}%
                       {-6\p@ \@plus -4\p@ \@minus -4\p@}%
                       {0\p@ \@plus 4\p@ \@minus 4\p@}%
                       {\large\XIIIPT\bfseries\boldmath
                        \rightskip=\z@ \@plus 8em\pretolerance=10000 \vspace{10pt}}}

\renewcommand\subsection{\@startsection{subsection}{0}{\z@}%
                       {-6\p@ \@plus -4\p@ \@minus -4\p@}%
                       {0\p@ \@plus 4\p@ \@minus 4\p@}%
                       {\normalfont\normalsize\bfseries\boldmath
                        \rightskip=\z@ \@plus 8em\pretolerance=10000 }}
\renewcommand\subsubsection{\@startsection{subsubsection}{0}{\z@}%
                       {-6\p@ \@plus -4\p@ \@minus -4\p@}%
                       {0\p@ \@plus 4\p@ \@minus 4\p@}%
                       {\normalfont\normalsize\em\boldmath
                        \rightskip=\z@ \@plus 8em\pretolerance=10000 }}

\subsubsectionfont{\normalfont\em\flushright}

\paragraphfont{\large}
                        
\RequirePackage{titlesec}
\titlelabel{\thetitle.\hspace{1ex}}
%\titleformat*{\subsubsection}{\normalfont\bfseries\sffamily\color{gray}}

% chapters
\definecolor{gray75}{gray}{0.75}
\newcommand{\hsp}{\hspace{20pt}}
\titleformat{\chapter}[hang]{\vspace{-50pt}\Huge\bfseries}{\thechapter\hsp\textcolor{gray75}{|}\hsp}{0pt}{\Huge\bfseries}

% enumerate custom commands
% set new counters
\newcounter{functionali}
\newcounter{nonfunctionali}
\newcounter{dependenciesi}
\newcounter{usecasei}
%\setcounter{usecasei}{1}

\newcommand{\requirement}[3]
{
  \item \textbf{#1} \hrule
  \begin{description}[style=multiline,leftmargin=4cm,font=\normalfont]
  \item[\textbf{Descri\c{c}\~{a}o:}]  #2
  \item[\textbf{N\'{i}vel de Prioridade:}] \textbf{#3}
  \end{description}
}

\newcommand{\dependency}[2]
{
  \item \textbf{#1} \hrule
  {#2}
}

\newcommand{\sfitem}[1]
{
  \item \textbf{#1} \hrule
  \vspace*{0.3cm}
}

\usepackage{fmtcount}% http://ctan.org/pkg/fmtcount
\newcommand{\usecase}[1]
{
  \stepcounter{usecasei}

  \subsection{\color{gray}[UC~\padzeroes[3]{\decimal{usecasei}}]~\color{black} #1}
}

\newcommand{\actors}
{
  \subsubsection*{Atores}
}

\newcommand{\actor}[2]
{
  \item[#1 -- ] #2
}

\newcommand{\preconditions}
{
  \subsubsection*{Pr\'{e}-condi\c{c}\~{o}es} 
}

\newcommand{\postconditions}
{
  \subsubsection*{P\'{o}s-condi\c{c}\~{o}es} 
}

\newcommand{\ucdiagram}[1]
{
  \subsubsection*{Diagrama de Caso de Uso}
  \FloatBarrier
  \begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth]{#1}
  \end{figure}
}

\newenvironment{mainflow}
{\subsubsection{Fluxo Principal de Eventos}
\begin{enumerate}
  \renewcommand{\labelenumi}{\bfseries\color{gray} P\arabic{enumi}. }
  \setlength{\itemsep}{1pt}
  \setlength{\parskip}{0pt}
  \setlength{\parsep}{0pt}
  \setlength{\itemindent}{25pt}}
{\end{enumerate}}

\newcommand{\litem}[1]{\item #1\begin{center}\rule{0.8\textwidth}{0.4pt}\end{center}}

\newenvironment{secondaryflow}
{\subsubsection{Fluxo Secundário: Alternativo}
\begin{enumerate}
  \renewcommand{\labelenumi}{\bfseries\color{gray} [SF\arabic{enumi}] }
  \renewcommand{\labelenumii}{\bfseries\color{gray} \arabic{enumii}. }
  \setlength{\itemsep}{1pt}
  \setlength{\parskip}{0pt}
  \setlength{\parsep}{0pt}
  \setlength{\itemindent}{11pt}}
{\end{enumerate}}

\newenvironment{functional}
{\vspace{15pt}\begin{enumerate}
  \renewcommand{\labelenumi}{\bfseries\color{gray} [FR\stepcounter{functionali}\arabic{functionali}] }
  \renewcommand{\labelenumii}{\bfseries\color{gray}\stepcounter{functionali}\arabic{functionali}. }
  \setlength{\itemsep}{15pt}
  \setlength{\parskip}{10pt}
  \setlength{\parsep}{0pt}
  \setlength{\itemindent}{13pt}}  
{\end{enumerate}}

\newenvironment{nonfunctional}
{\vspace{15pt}\begin{enumerate}
  \setcounter{enumi}{0} % turn it transparent to the writer
  \renewcommand{\labelenumi}{\bfseries\color{gray} [NFR\stepcounter{nonfunctionali}\arabic{nonfunctionali}] }
  \renewcommand{\labelenumii}{\bfseries\color{gray}\stepcounter{nonfunctionali}\arabic{nonfunctionali}. }
  \setlength{\itemsep}{15pt}
  \setlength{\parskip}{10pt}
  \setlength{\parsep}{0pt}
  \setlength{\itemindent}{22pt}}
{\end{enumerate}}

\newenvironment{dependencies}
{\vspace{15pt}\begin{enumerate}
  \renewcommand{\labelenumi}{\bfseries\color{gray} [D\stepcounter{dependenciesi}\arabic{enumi}] }
  \renewcommand{\labelenumii}{\bfseries\color{gray}\stepcounter{dependenciesi}\arabic{enumi}. }
  \setlength{\itemsep}{15pt}
  \setlength{\parskip}{10pt}
  \setlength{\parsep}{0pt}
  \setlength{\itemindent}{7pt}}
{\end{enumerate}}
